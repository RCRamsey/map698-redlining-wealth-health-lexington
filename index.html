<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <title>Redlining Prevents Wealth</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Mapbox assembly minified css stylesheet-->
    <link href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css" rel="stylesheet" />
    <!-- Mapbox GL JS Reference stylesheet-->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css" rel="stylesheet" />

    <!-- my general css styles -->
    <link href='css/styles.css' rel='stylesheet' />

    <!-- remove prior to publishing final product DEVELOPMENTAL purposes only -->
    <!-- request styles for mapbox-gl-inspect  -->
    <!-- <link href='https://github.com/lukasmartinelli/mapbox-gl-inspect/releases/download/v1.3.1/mapbox-gl-inspect.css' rel='stylesheet' /> -->
    <!-- request js for mapbox-gl-inspect-->
    <!-- <script src='https://github.com/lukasmartinelli/mapbox-gl-inspect/releases/download/v1.3.1/mapbox-gl-inspect.js'></script> -->

    <!-- to consider loading other font -->
    <!-- <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'> -->

    <style>
        /* styles stored in styles.css file */
    </style>
</head>

<body>

    <header class=' bg-darken25 border-b border--white txt-bold pt10 pb10 py10'>        
        <h1 class='flex flex--center-main'> How Racial Capitalism Persists today in Lexington, KY: <br> An exploration of 1930s Redlining Practices</h1>
       
        <nav class='fr flex flex--column'>
            <div class='layer-button-container'>
                <!-- unordered list -->
                <ul>
                    <li class='dropdown mx3 my3'>
                        <a class='flex flex--center-main btn btn--stroke btn--white bg-darken25 bg-darken50-on-hover bg-gray-dark-on-active txt-xs ml3'
                            href='#'>
                            <svg class='icon txt-s mr1'>
                                <use xlink:href='#icon-layers' />
                            </svg> Layers
                        </a>
                        <div class='dropdown-content txt-s'>
                            <a value='race' href='#'>Segregation/Race</a>
                            <a value='income' href='#'>Median Household Income</a>
                            <a value='ownership' href='#'>% Home Ownership</a>
                            <a href='#'>Property Value Reported</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <div id='display-container'>

        <div id='map1-container' class=''>
            <div id='map'></div>
            <!-- map1 legend -->
            <div class='map-overlay bottom mr-neg24 mb36 z3 absolute'>
                <div class='map-overlay-inner'>
                    <div id='legend1'><h3>Likelihood of Loan</h3></div>
                        <!-- legend-bar will be dynamically updated with JS based on selected attribute -->
                        <div id='legend1-bar'></div>
                        <!-- Add min & max labels -->
                        <div class = 'legend-label flex flex--space-between-main'>
                            <div id='legend1-label-min'><h3>Not Likley</h3></div> 
                            <div id ='legend1-label-max'><h3>Likley</h3></div>   
                        </div>
                </div>
            </div>

            <div id="info-button-container flex flex--row-reverse">
                <ul>
                    <li class = 'mx3 my3'>
                        <!-- Info Button to trigger open Modal -->
                        <!-- -on-active is-active-->
                        <button id='infoButton'>
                            <a class='flex flex--center-main btn btn--stroke btn--white bg-darken25 bg-darken50-on-hover bg-gray-dark-on-active txt-xs ml3 '
                                href='#'>
                                <svg class='icon txt-m mr2'>
                                    <use xlink:href='#icon-bookmark'/>
                                </svg> Redlining Map Info
                            </a>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
        <!-- insert opacity slider bar and give initial start opacity, use as developer tool-->
        <!-- <div class='map-overlay bottom ml24 mb36 z2 absolute'>
            <div class='map-overlay-inner'>
                <label>Redlined Layer Opacity: <span id='slider-value'>100%</span></label>
                <input id='slider' type='range' min='0' max='100' step='0' value='100'>
            </div>
        </div> -->
        <div id='map2-container' class=''>
            <div id='map2'></div>
            <!-- bottom margin left margin -->
            <div class='map-overlay bottom mr-neg24 mb36 z3 absolute'>
                <div class='map-overlay-inner'>
                    <div id='legend2'><h3>Legend Label</h3></div>
                        <!-- legend-bar will be dynamically updated with JS based on selected attribute -->
                        <div id='legend2-bar'></div>
                        <!-- Add min & max labels -->
                        <div class = 'legend-label flex flex--space-between-main'> 
                            <div id='legend2-label-min'><h3>0%</h3></div> 
                            <div id ='legend2-label-max'><h3>100%</h3></div>   
                        </div>
                    </div>
            </div>

        </div>

        <!-- The Modal to open from infoButton in nav bar -->
        <div id="infoModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <!-- Close modal by clicking outside modal -->
                <span class="close"></span>
                <!-- scrolling text; not sure you need this now since the modal is outside the map and will scroll -->
                <div class='px12 py12 overflow-auto h-full'>
                    <h3 class='txt-m txt-bold mb6'>Title Here</h3>
                    <p>In life you need colors. It's beautiful - and we haven't even done anything to it yet. You
                        can spend all day playing with mountains.
                        In nature, dead trees are just as normal as live trees. Everyone wants to enjoy the good parts -
                        but you have to build the framework first. Anytime you learn something your time and energy are
                        not wasted. Let your imagination be your guide. There is immense joy in just watching - watching
                        all the little creatures in nature.
                        See how easy it is to create a little tree right in your world. It's important to me that
                        you're happy. Let's make a nice big leafy tree.
                        A tree cannot be straight if it has a crooked trunk. It is a lot of fun. You can create
                        anything that makes you happy. Anyone can paint. We don't need any guidelines or formats.
                        All we need to do is just let it flow right out of us.
                        With something so strong, a little bit can go a long way. Even the worst thing we can do
                        here is good. Isn't that fantastic? You can just push a little tree out of your brush like
                        that. We'll paint one happy little tree right here. Let that brush dance around there and
                        play.
                        Let's put some highlights on these little trees. The sun wouldn't forget them. You don't
                        have to be crazy to do this but it does help. And just raise cain. We'll put some happy
                        little leaves here and there.
                        Have fun with it. This piece of canvas is your world. We start with a vision in our heart,
                        and we put it on canvas. Go out on a limb - that's where the fruit is. Just let go - and
                        fall like a little waterfall. There comes a nice little fluffer.

                        In life you need colors. It's beautiful - and we haven't even done anything to it yet. You
                        can spend all day playing with mountains.
                        In nature, dead trees are just as normal as live trees. Everyone wants to enjoy the good parts -
                        but you have to build the framework first. Anytime you learn something your time and energy are
                        not wasted. Let your imagination be your guide. There is immense joy in just watching - watching
                        all the little creatures in nature.
                        See how easy it is to create a little tree right in your world. It's important to me that
                        you're happy. Let's make a nice big leafy tree.
                        A tree cannot be straight if it has a crooked trunk. It is a lot of fun. You can create
                        anything that makes you happy. Anyone can paint. We don't need any guidelines or formats.
                        All we need to do is just let it flow right out of us.
                        With something so strong, a little bit can go a long way. Even the worst thing we can do
                        here is good. Isn't that fantastic? You can just push a little tree out of your brush like
                        that. We'll paint one happy little tree right here. Let that brush dance around there and
                        play.
                        Let's put some highlights on these little trees. The sun wouldn't forget them. You don't
                        have to be crazy to do this but it does help. And just raise cain. We'll put some happy
                        little leaves here and there.
                        Have fun with it. This piece of canvas is your world. We start with a vision in our heart,
                        and we put it on canvas. Go out on a limb - that's where the fruit is. Just let go - and
                        fall like a little waterfall. There comes a nice little fluffer.
                    </p>

                    <!-- adding any images to the modal -->
                    <!-- <img class="img-fluid" src="images/na-brew.jpg" alt="2019 North America Concentration of Breweries Map"> -->

                    <div class="modal-footer">
                        <a target="_blank" href="https://github.com/RCRamsey/map698-redlining-wealth-lexington">
                            <button type="button" class="btn btn-primary">View Repo</button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script async defer src="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- using plugin for opacity -->
    <script type='module' src="js/app.js"></script>

    <script>

        // map & map 2 access token
        mapboxgl.accessToken =
            'pk.eyJ1IjoicmNyYW1zZXkiLCJhIjoiY2wxNTJkeDkxMmE2NzNrcnR1YWp4bTJuZSJ9.VJgeO7B_6LZ3Uv9NTzaNVQ'

        // map 1 script
        const map = new mapboxgl.Map({
            container: 'map', //container ID
            style: 'mapbox://styles/rcramsey/cl3k1etf1002c14lxlfg3l57v',// âœï¸ style URL refine later
            center: [-84.51, 38.04], //strating position [lng, lat]
            zoom: 12 //starting zoom
        });

        // remove later ... part of dev tools
        // const slider = document.getElementById('slider');
        // slider.addEventListener('input', (e) => {
        //     // Adjust the layers opacity.
        //     map.setPaintProperty(
        //         // source Id
        //         'redlining',
        //         // when the layer is created in mapbox from my geojson, it is added as a raster? right?
        //         'fill-opacity',
        //         parseInt(e.target.value, 10) / 100
        //     );
        //     // Value Indicator
        //     sliderValue.textContent = e.target.value + '%';
        // });

        // const sliderValue = document.getElementById('slider-value');

        // Modal UI access using native js
        var modal = document.getElementById("infoModal");
        // Get button that opens the modal
        // var btn = document.getElementById("myBtn");
        const ibtn = document.getElementById('infoButton');
        // Get the <span> element that closes the modal
        const spanCloseModal = document.getElementsByClassName("close")[0];  // rename var to const other than span
        // When the user clicks the button, open the modal 
        ibtn.onclick = function () {
            modal.style.display = "block";
        };
        // When the user clicks on <span> (x), close the modal
        // spanCloseModal.onclick = function () {
        //     modal.style.display = "none";
        // };
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

        // use D3 method on map 1 to load GeoJSON when the map is finished loading
        map.on('load', () => {
            // request GEOJSON data
            d3.json('./data/KYLexington1936.geojson').then((geojson) => {
                // when loaded
                console.log(geojson);

                // call addLayer() function in scope
                addLayer(geojson);
            });
        });

        // define addLayer() function outside of scope
        function addLayer(geojson) {
            // add the source to the map
            map.addSource('redlining', {
                'type': 'geojson',
                'data': geojson // use my data as source
            });

            // add the GeoJSON data as a mapbox gl layer (now a raster?) to visualize polygon
            map.addLayer({
                'id': 'redlining', // provide new id for later reference 
                'type': 'fill',
                'source': 'redlining', //refers to data source name entered above
                'paint': {
                    'fill-color': [ // '#00364e', initial fill color until add identity
                        'match',
                        ['get', 'holc_grade'],
                        'A',
                        '#5B7386',
                        'B',
                        '#92A6B5',
                        'C',
                        '#C2CDD6',
                        'D',
                        '#E6EBEF',
                        // other not caught
                        'black'
                    ],
                    'fill-opacity': .7, //initial opacity until slider added
                    'fill-outline-color': 'black'
                }
            });
        };
        
        // map 2 script
        const map2 = new mapboxgl.Map({
            container: 'map2', //container ID
            style: 'mapbox://styles/rcramsey/cl3k1etf1002c14lxlfg3l57v',// âœï¸ style URL refine later
            center: [-84.51, 38.04], //starting position [lng, lat]
            zoom: 12 //starting zoom
        });

        // use D3 method on map 2 to load GeoJSON when the map is finished loading
        map2.on('load', () => {
            // request GEOJSON data
            //d3.json('./data/KYLexington1936.geojson').then((geojson) => {
            d3.json('./data/race_cbtracts_hhi_own_val_pov_2019_gdf_json.json').then((geojson) => {
                // when loaded
                console.log(geojson);
                // call addLayer() function in scope
                addLayer2(geojson);
                mapSync();
            });
        });

        // define addLayer() function outside of scope
        function addLayer2(geojson) {
            // add the source to the map
            map2.addSource('census', {
                'type': 'geojson',
                'data': geojson // use my data as source
            });

            // add the GeoJSON data as a mapbox gl layer to visualize polygon
            // access census bureau race/segretation data
            map2.addLayer({
                'id': 'race', // provide new id for later reference 
                'type': 'fill',
                'source': 'census', //refers to data source name entered above
                'layout':
                {
                    'visibility': 'visible'
                },
                'paint': {
                    'fill-color': {
                        property: '%White',
                        stops: [[0, '#FFFFFF'], [25, '#C5E2FC'], [75,'#51ABF6'], [100, '#115292']],
                    },
                    'fill-opacity': .70, //initial opacity until slider added
                    'fill-outline-color': 'black'
                }
            });

            // access census bureaus median income data
            map2.addLayer({
                'id': 'income', // provide new id for later reference 
                'type': 'fill',
                'source': 'census', //refers to data source name entered above
                'layout':
                {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-color': {
                        property: 'median_income_dollars',
                        stops: [[20000, '#E7EFEE'], [50000,'#B6CECC'], [80000,'#89B0AE'], [120000, '#629390']],
                    },
                    'fill-opacity': .70, //initial opacity until slider added
                    'fill-outline-color': 'black'
                }
            });

            // access census bureau ownership vs rental status data
            map2.addLayer({
                'id': 'ownership', // provide new id for later reference 
                'type': 'fill',
                'source': 'census', //refers to data source name entered above
                'layout':
                {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-color': {
                        property: '%owner',
                        stops: [[0, '#F7D1CD'], [25, '#D1B3C4'], [75, '#B392AC'], [100, '#735D78']],
                    },
                    'fill-opacity': .70, //initial opacity until slider added
                    'fill-outline-color': 'black'
                }
            });


            addUI();
            whatsMap2Style('race');

            // // Access census bureau property data
            //ðŸ§¯ Need to convert string value to number valueðŸ§¯ 
            // map2.addLayer({
            //     'id': 'propertyValue', // provide new id for later reference 
            //     'type': 'fill',
            //     'source': 'census', //refers to data source name entered above
            //     'paint': {
            //         'fill-color': {
            //             property: 'median dollar house',
            //           //  ['to-number', ['get', 'median dollar house']],
            //             stops: [[100000, '#e5f5e0'], [1000000, '#31a354']],
            //         },
            //         'fill-opacity': 1, //initial opacity until slider added
            //         'fill-outline-color': 'white'
            //     }
            // });
        };

        // Use d3 to select all 'a' targets in dropdown menu
        // when clicked the value of that current target is passed to function updateCurrentLayer
        function addUI() {
            d3.selectAll('.dropdown-content a').on('click', (e) => {
                let currentValue = d3.select(e.target).attr('value');
                updateCurrentLayer(currentValue);
                whatsMap2Style(currentValue);
            });
        }

        // pass value from div class drop down content in drop down menu
        // function to set all visibility to none until.
        function updateCurrentLayer(val) {
            map2.setLayoutProperty('race', 'visibility', 'none');
            map2.setLayoutProperty('income', 'visibility', 'none');
            map2.setLayoutProperty('ownership', 'visibility', 'none');
            // change visibility to visible for whicheer val is clicked in drop down menu
            map2.setLayoutProperty(val, 'visibility', 'visible');
        }

        // Map & Map 2 syncing movement
        function mapSync() {
            // if disable true then the map will be displayed as non-interactive
            var disable = false; // interactive
            map.on('move', function () {

                if (!disable) { // boolean, if not do below
                    var center = map.getCenter();
                    var zoom = map.getZoom();

                    // convert disable to be true
                    // prevents looping between both maps so only one can be moved
                    disable = true; // map 1 non interactive (static)

                    // set map 2 to new map center & zoom
                    map2.setCenter(center);
                    map2.setZoom(zoom);
                    disable = false; // map 1 back to interactive
                }
            })

            map2.on('move', function () {
                if (!disable) { // boolean, it not true do below
                    var center = map2.getCenter();
                    var zoom = map2.getZoom();

                    // convert disable to be true
                    // prevents looping between both maps so only one can be moved
                    disable = true; // map 2 non interactive (static)

                    // set first map to new map 2 center & zoom
                    map.setCenter(center);
                    map.setZoom(zoom);
                    disable = false; // map 2 back to interactive
                }
            })
        };

        //Updating legend to reflect map2 layer styles
        //Determine UI layer selected, apply appropriate color gradient to legend
        function whatsMap2Style(val) {
            // access legend-bar for color gradient modification
            let legend2Bar = document.getElementById('legend2-bar');
            let legend2Title = document.getElementById('legend2');
            let legend2Min = document.getElementById('legend2-label-min');
            let legend2Max = document.getElementById('legend2-label-max');

            // if value from UI is race update color gradient to legend
            if (val == 'race') {
                console.log('value is race');
                legend2Bar.style.background = 'linear-gradient(to right, #FFFFFF, #C5E2FC, #51ABF6, #115292)';
               // place holder for accessing and modifying text to legend
               legend2Title.innerHTML = '<h3>% White</h3>';
                legend2Min.innerHTML = '<h3>low</h3>';
                legend2Max.innerHTML = '<h3>high</h3>';
           // if value from UI is income update color gradient to legend
            } else if (val == 'income') {
                console.log('value is income');
                legend2Bar.style.background = 'linear-gradient(to right, #E7EFEE, #B6CECC, #89B0AE, #629390)';
                legend2Title.innerHTML = '<h3>Median Income</h3>';
                legend2Min.innerHTML = '<h3>lower</h3>';
                legend2Max.innerHTML = '<h3>higher</h3>';
            // if value from UI is ownership update color gradient to legend
            } else if (val == 'ownership') {
                console.log('value is ownership');
                legend2Bar.style.background = 'linear-gradient(to right, #F7D1CD, #D1B3C4, #B392AC, #735D78 )';
                legend2Title.innerHTML = '<h3>% Ownership</h3>';
                legend2Min.innerHTML = '<h3>lower</h3>';
                legend2Max.innerHTML = '<h3>higher</h3>';
            }
            // if value from UI is propertyValue update color gradient to legend
            // else if (val == 'propertyValue') {
            //     console.log('value is propertyValue');
            // } 
            // if no value is accessible produce comment in console log
            else {
                console.log('no value selected');
            };
        };


    </script>

</body>
</html>