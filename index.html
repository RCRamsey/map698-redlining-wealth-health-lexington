<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8'/>
    <title>Redlining Prevents Wealth</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
    
    <!-- Mapbox assembly minified css stylesheet-->
    <link 
        href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css" rel="stylesheet"/>
    <!-- Mapbox GL JS Reference stylesheet-->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css" rel="stylesheet"/>
    
    <!-- Plugin for opacity tool -->
    <link href="plugin/mapbox-gl-opacity/dist/mapbox-gl-opacity.css" rel="stylesheet">

    <!-- my general css styles -->
    <link href='css/styles.css' rel='stylesheet' />
    
    <!-- remove prior to publishing final product DEVELOPMENTAL purposes only -->
    <!-- request styles for mapbox-gl-inspect  -->
    <!-- <link href='https://github.com/lukasmartinelli/mapbox-gl-inspect/releases/download/v1.3.1/mapbox-gl-inspect.css' rel='stylesheet' /> -->
    <!-- request js for mapbox-gl-inspect-->
    <!-- <script src='https://github.com/lukasmartinelli/mapbox-gl-inspect/releases/download/v1.3.1/mapbox-gl-inspect.js'></script> -->
    
    <!-- to consider loading other font -->
    <!-- <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'> -->

    <style>
        /* styles stored in styles.css file */

    </style>
</head>

<body>
    <div id ='map'></div>
    

    <!-- insert opacity slider bar and give initial start opacity-->
    <div class="map-overlay bottom ml24 mb36 z2" >
        <div class="map-overlay-inner">
        <label>Redlined Layer Opacity: <span id="slider-value">100%</span></label>
        <input id="slider" type="range" min="0" max="100" step="0" value="100">
        </div>
    </div>

    <!-- info button to hide scrolling info panel -->
    <button id='infoButton'>Info</button>

    <!-- info floating side panel -->
    <div id ='infoPanel'>
        <div class='relative top-ml left z1 w-1/6 px12 py12-ml'>
            <div class='flex flex--column h-viewport-5/6 bg-white round-ml shadow-darken10 events-all'>
                <!-- scrolling text -->
                <div class='px12 py12 overflow-auto h-full'>
                    <h3 class='txt-m txt-bold mb6'>Title here</h3>
                    <p>In life you need colors. It's beautiful - and we haven't even done anything to it yet. You can spend all day playing with mountains.
                        In nature, dead trees are just as normal as live trees. Everyone wants to enjoy the good parts - but you have to build the framework first. Anytime you learn something your time and energy are not wasted. Let your imagination be your guide. There is immense joy in just watching - watching all the little creatures in nature.
                        See how easy it is to create a little tree right in your world. It's important to me that you're happy. Let's make a nice big leafy tree.
                        A tree cannot be straight if it has a crooked trunk. It is a lot of fun. You can create anything that makes you happy. Anyone can paint. We don't need any guidelines or formats. All we need to do is just let it flow right out of us.
                        With something so strong, a little bit can go a long way. Even the worst thing we can do here is good. Isn't that fantastic? You can just push a little tree out of your brush like that. We'll paint one happy little tree right here. Let that brush dance around there and play.
                        Let's put some highlights on these little trees. The sun wouldn't forget them. You don't have to be crazy to do this but it does help. And just raise cain. We'll put some happy little leaves here and there.
                        Have fun with it. This piece of canvas is your world. We start with a vision in our heart, and we put it on canvas. Go out on a limb - that's where the fruit is. Just let go - and fall like a little waterfall. There comes a nice little fluffer.
                    </p>
                </div>
            
                <footer class='px12 py12 bg-gray-faint round-b-ml txt-s'>
                    Footer content here
                </footer> -->
            </div>
        </div>
    </div>

    <div id="title" value="newest title"> <h1 class ='txt-bold'>How Racial Capitalism Persists today in Lexington, KY</h2>
        <h2 class ='txt-bold'>An exploration of 1930s Redlining Practices</h2>
    </div>
       
    <div id ='map2'></div>

    <script async defer src="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <!-- using plugin for opacity -->
    <script type ='module' src="js/app.js"></script>

    <script>

        // map & map 2 access token
        mapboxgl.accessToken =
        'pk.eyJ1IjoicmNyYW1zZXkiLCJhIjoiY2wxNTJkeDkxMmE2NzNrcnR1YWp4bTJuZSJ9.VJgeO7B_6LZ3Uv9NTzaNVQ'
        
        // map 1 script
        const map = new mapboxgl.Map({
            container: 'map', //container ID
            style: 'mapbox://styles/rcramsey/cl0fo22zx000514ms9ohin6tx',// ✏️ style URL refine later
            center: [-84.51, 38.04], //strating position [lng, lat]
            zoom: 12 //starting zoom
        });

       const slider = document.getElementById('slider');
       const sliderValue = document.getElementById('slider-value');

        // use D3 method on map 1 to load GeoJSON when the map is finished loading
        map.on('load',() => {
            // request GEOJSON data
            d3.json('./data/KYLexington1936.geojson').then((geojson) => {
                // when loaded
                 console.log(geojson);

                // call addLayer() function in scope
                addLayer(geojson);
            });

            slider.addEventListener('input', (e)=> {
                // Adjust the layers opacity.
                map.setPaintProperty(
                    // source Id
                    'redlining',
                    // when the layer is created in mapbox from my geojson, it is added as a raster? right?
                    'fill-opacity',
                    parseInt(e.target.value, 10) / 100
                );

                // Value Indicator
                sliderValue.textContent = e.target.value + '%';
            });
        });

        // define addLayer() function outside of scope
        function addLayer(geojson) {
            // add the source to the map
            map.addSource('redlining', {
                'type': 'geojson',
                'data': geojson // use my data as source
            });
            
            // add the GeoJSON data as a mapbox gl layer (now a raster?) to visualize polygon
            map.addLayer({
                'id': 'redlining', // provide new id for later reference 
                'type': 'fill',
                'source': 'redlining', //refers to data source name entered above
                'paint': {
                    'fill-color': [ // '#00364e', initial fill color until add identity
                        'match',
                        ['get', 'holc_grade'],
                        'A',
                        'green',
                        'B',
                        'blue',
                        'C',
                        'yellow',
                        'D',
                        'red',
                        // other not caught
                        'black' 
                    ],
                    //'fill-opacity': 1, //initial opacity until slider added
                    //'fill-outline-color': 'white'
                }
            });
        };
        


        // map 2 script
            const map2 = new mapboxgl.Map({
                container: 'map2', //container ID
                style: 'mapbox://styles/rcramsey/cl0fo22zx000514ms9ohin6tx',// ✏️ style URL refine later
                center: [-84.51, 38.04], //strating position [lng, lat]
                zoom: 12 //starting zoom
            });

            // const slider2 = document.getElementById('slider2');
            // const sliderValue2 = document.getElementById('slider-value2');

            // use D3 method on map 2 to load GeoJSON when the map is finished loading
            map2.on('load',() => {
                // request GEOJSON data
                //d3.json('./data/KYLexington1936.geojson').then((geojson) => {
                d3.json('./data/race_cbtracts_hhi_own_val_pov_2019_gdf_json.json').then((geojson) => {
                    // when loaded
                    console.log(geojson);

                    // call addLayer() function in scope
                    addLayer2(geojson);
                    mapSync();
                });

                // slider.addEventListener('input', (e)=> {
                //     // Adjust the layers opacity.
                //     map2.setPaintProperty(
                //         // source Id
                //         'other',
                //         // when the layer is created in mapbox from my geojson, it is added as a raster? right?
                //         'fill-opacity',
                //         parseInt(e.target.value, 10) / 100
                //     );

                //     // Value Indicator
                //     sliderValue.textContent = e.target.value + '%';
                // });
            });

            // define addLayer() function outside of scope
            function addLayer2(geojson) {
                // add the source to the map
                map2.addSource('other', {
                    'type': 'geojson',
                    'data': geojson // use my data as source
                });
                
                // add the GeoJSON data as a mapbox gl layer (now a raster?) to visualize polygon
                map2.addLayer({
                    'id': 'other', // provide new id for later reference 
                    'type': 'fill',
                    'source': 'other', //refers to data source name entered above
                    'paint': {
                        'fill-color': [ // '#00364e', initial fill color until add identity
                            'match',
                            ['get', 'holc_grade'],
                            'A',
                            'green',
                            'B',
                            'blue',
                            'C',
                            'yellow',
                            'D',
                            'red',
                            // other not caught
                            'black' 
                        ],
                        'fill-opacity': 1, //initial opacity until slider added
                        'fill-outline-color': 'white'
                    }
                });
            };

    
        // select infoPanel using infoButton with click event listener to hide or display infoPanel
        const targetInfoPanel = document.getElementById('infoPanel');
        targetInfoPanel.style.display = 'none';
        
        const btn = document.getElementById('infoButton');
        btn.onclick = function () {
            if (targetInfoPanel.style.display !== 'block') {
                targetInfoPanel.style.display = 'block';
            } else {
                targetInfoPanel.style.display = 'none';
            }
        };
        // add zoom and rotation controls to map
       map.addControl(new mapboxgl.NavigationControl());

    // Map & Map 2 syncing movement
    function mapSync(){ 
        // if disable true then the map will be displayed as non-interactive
        var disable = false; // interactive
        map.on('move', function(){
           
            if(!disable) { // boolean, if not do below
                var center = map.getCenter();
                var zoom = map.getZoom();
                
                // convert disable to be true
                // prevents looping between both maps so only one can be moved
                disable = true; // map 1 non interactive (static)

                // set map 2 to new map center & zoom
                map2.setCenter(center);
                map2.setZoom(zoom);
                disable = false; // map 1 back to interactive
            }
        })

        map2.on('move', function(){
            if(!disable) { // boolean, it not true do below
                var center = map2.getCenter();
                var zoom = map2.getZoom();

                // convert disable to be true
                // prevents looping between both maps so only one can be moved
                disable = true; // map 2 non interactive (static)

                // set first map to new map 2 center & zoom
                map.setCenter(center);
                map.setZoom(zoom);
                disable = false; // map 2 back to interactive
            }
        })

        // mouse moving event
        map.on('mousemove', function (e) {
            map.featuresAt(e.point, {radius: 5}, function (error, features) {
                if (error) throw error;
            })
        });
    
    };


        // add mapbox inspection tool for development only
        // ✏️  when i add this control, click and unclick I lose my layer
        // map.addControl(new MapboxInspect());  // click on box top right hand corner to 

    </script>

</body>
</html>