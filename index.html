<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8' />
    <title>Redlining Prevents Wealth</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Mapbox assembly minified css stylesheet-->
    <link href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css" rel="stylesheet" />
    <!-- Mapbox GL JS Reference stylesheet-->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css" rel="stylesheet" />

    <!-- Plugin for opacity tool -->
    <link href="plugin/mapbox-gl-opacity/dist/mapbox-gl-opacity.css" rel="stylesheet">

    <!-- my general css styles -->
    <link href='css/styles.css' rel='stylesheet' />

    <!-- remove prior to publishing final product DEVELOPMENTAL purposes only -->
    <!-- request styles for mapbox-gl-inspect  -->
    <!-- <link href='https://github.com/lukasmartinelli/mapbox-gl-inspect/releases/download/v1.3.1/mapbox-gl-inspect.css' rel='stylesheet' /> -->
    <!-- request js for mapbox-gl-inspect-->
    <!-- <script src='https://github.com/lukasmartinelli/mapbox-gl-inspect/releases/download/v1.3.1/mapbox-gl-inspect.js'></script> -->

    <!-- to consider loading other font -->
    <!-- <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'> -->

    <style>
        /* styles stored in styles.css file */
    </style>
</head>

<body>

    <header class='bg-darken75 border-b border--black txt-bold pt24 pb24 px30'>
        <h1 class='inline-block'> How Racial Capitalism Persists today in Lexington, KY:</h1><br>
        <h2 class='inline-block'>An exploration of 1930s Redlining Practices</h2>
        <nav class='fr inline-block'>
            <div class=''>
                <!-- unordered list -->
                <ul>
                    <li class='dropdown mr36'>
                        <a class='inline-flex btn btn--stroke btn--white bg-transparent bg-darken10-on-hover bg-gray-dark-on-active txt-s ml3'
                            href='#'>
                            <svg class='icon txt-s mr1'>
                                <use xlink:href='#icon-layers' />
                            </svg> Layers
                        </a>

                        <div class='dropdown-content'>
                            <a value='race' href='#'>Segregation/Race</a>
                            <a value='income' href='#'>Median Household Income</a>
                            <a value='ownership' href='#'>% Home Ownership</a>
                            <a href='#'>Property Value Reported</a>
                        </div>
                    </li>
                    <li>
                        <!-- Info Button to trigger open Modal -->
                        <!-- -on-active is-active-->
                        <button id='infoButton'>
                            <a class='inline-flex btn btn--stroke btn--white bg-transparent bg-darken10-on-hover bg-gray-dark-on-active txt-s ml3 '
                                href='#'>
                                <svg class='icon txt-s mr6'>
                                    <use xlink:href='#icon-bookmark' />
                                </svg> Info
                            </a>
                        </button>
                    </li>
                </ul>
            </div>
        </nav>

        

    </header>

    <div id='displayContainer'>

        <div id='map'></div>

        <!-- insert opacity slider bar and give initial start opacity, use as developer tool-->
        <div class='map-overlay bottom ml24 mb36 z2'>
            <div class='map-overlay-inner'>
                <label>Redlined Layer Opacity: <span id='slider-value'>100%</span></label>
                <input id='slider' type='range' min='0' max='100' step='0' value='100'>
            </div>
        </div>

        <div id='map2'>
             <!-- bottom margin left margin bottom -->
            <div class='map-overlay bottom mr-neg24 mb36 z3'>
                <div class='map-overlay-inner'>
                    <div id ='map2Legend'> 
                        <div id = 'legend'>
                            <div class = 'bar'></div>
                            <div>Legend Label</div>
                        <!-- <label>Legend Label</label> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
       

        <!-- The Modal to open from infoButton in nav bar -->
        <div id="infoModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
                <!-- Close modal by clicking outside modal -->
                <span class="close"></span>
                <!-- scrolling text; not sure you need this now since the modal is outside the map and will scroll -->
                <div class='px12 py12 overflow-auto h-full'>
                        <h3 class='txt-m txt-bold mb6'>Title Here</h3>
                            <p>In life you need colors. It's beautiful - and we haven't even done anything to it yet. You
                            can spend all day playing with mountains.
                            In nature, dead trees are just as normal as live trees. Everyone wants to enjoy the good parts - but you have to build the framework first. Anytime you learn something your time and energy are not wasted. Let your imagination be your guide. There is immense joy in just watching - watching all the little creatures in nature.
                            See how easy it is to create a little tree right in your world. It's important to me that
                            you're happy. Let's make a nice big leafy tree.
                            A tree cannot be straight if it has a crooked trunk. It is a lot of fun. You can create
                            anything that makes you happy. Anyone can paint. We don't need any guidelines or formats.
                            All we need to do is just let it flow right out of us.
                            With something so strong, a little bit can go a long way. Even the worst thing we can do
                            here is good. Isn't that fantastic? You can just push a little tree out of your brush like
                            that. We'll paint one happy little tree right here. Let that brush dance around there and
                            play.
                            Let's put some highlights on these little trees. The sun wouldn't forget them. You don't
                            have to be crazy to do this but it does help. And just raise cain. We'll put some happy
                            little leaves here and there.
                            Have fun with it. This piece of canvas is your world. We start with a vision in our heart,
                            and we put it on canvas. Go out on a limb - that's where the fruit is. Just let go - and
                            fall like a little waterfall. There comes a nice little fluffer.

                            In life you need colors. It's beautiful - and we haven't even done anything to it yet. You
                            can spend all day playing with mountains.
                            In nature, dead trees are just as normal as live trees. Everyone wants to enjoy the good parts - but you have to build the framework first. Anytime you learn something your time and energy are not wasted. Let your imagination be your guide. There is immense joy in just watching - watching all the little creatures in nature.
                            See how easy it is to create a little tree right in your world. It's important to me that
                            you're happy. Let's make a nice big leafy tree.
                            A tree cannot be straight if it has a crooked trunk. It is a lot of fun. You can create
                            anything that makes you happy. Anyone can paint. We don't need any guidelines or formats.
                            All we need to do is just let it flow right out of us.
                            With something so strong, a little bit can go a long way. Even the worst thing we can do
                            here is good. Isn't that fantastic? You can just push a little tree out of your brush like
                            that. We'll paint one happy little tree right here. Let that brush dance around there and
                            play.
                            Let's put some highlights on these little trees. The sun wouldn't forget them. You don't
                            have to be crazy to do this but it does help. And just raise cain. We'll put some happy
                            little leaves here and there.
                            Have fun with it. This piece of canvas is your world. We start with a vision in our heart,
                            and we put it on canvas. Go out on a limb - that's where the fruit is. Just let go - and
                            fall like a little waterfall. There comes a nice little fluffer.
                            </p>
                            
                            <!-- adding any images to the modal -->
                            <!-- <img class="img-fluid" src="images/na-brew.jpg" alt="2019 North America Concentration of Breweries Map"> -->

                            <div class="modal-footer">
                                    <a target="_blank" href="https://github.com/RCRamsey/map698-redlining-wealth-lexington">
                                        <button type="button" class="btn btn-primary">View Repo</button>
                                    </a>
                            </div>

                </div>
            </div>
        </div>
            
    </div>



    <script async defer src="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- using plugin for opacity -->
    <script type='module' src="js/app.js"></script>

    <script>

        // map & map 2 access token
        mapboxgl.accessToken =
            'pk.eyJ1IjoicmNyYW1zZXkiLCJhIjoiY2wxNTJkeDkxMmE2NzNrcnR1YWp4bTJuZSJ9.VJgeO7B_6LZ3Uv9NTzaNVQ'

        // map 1 script
        const map = new mapboxgl.Map({
            container: 'map', //container ID
            style: 'mapbox://styles/rcramsey/cl0fo22zx000514ms9ohin6tx',// ‚úèÔ∏è style URL refine later
            center: [-84.51, 38.04], //strating position [lng, lat]
            zoom: 12 //starting zoom
        });

        const slider = document.getElementById('slider');
        const sliderValue = document.getElementById('slider-value');

        //access color gradient of legend
       const element = document.getElementById('legend');
       const style = getComputedStyle(element);
       //console.log(style.background)
       const colorGradient = style.background // access to gradient of legend bar 
       //console.log(colorGradient) 

        // Modal UI
        var modal = document.getElementById("infoModal");
        // Get the button that opens the modal
        // var btn = document.getElementById("myBtn");
        const ibtn = document.getElementById('infoButton');
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        // When the user clicks the button, open the modal 
        ibtn.onclick = function() {
            modal.style.display = "block";
        };
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        };
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };


        // use D3 method on map 1 to load GeoJSON when the map is finished loading
        map.on('load', () => {
            // request GEOJSON data
            d3.json('./data/KYLexington1936.geojson').then((geojson) => {
                // when loaded
                console.log(geojson);

                // call addLayer() function in scope
                addLayer(geojson);
            });

            slider.addEventListener('input', (e) => {
                // Adjust the layers opacity.
                map.setPaintProperty(
                    // source Id
                    'redlining',
                    // when the layer is created in mapbox from my geojson, it is added as a raster? right?
                    'fill-opacity',
                    parseInt(e.target.value, 10) / 100
                );

                // Value Indicator
                sliderValue.textContent = e.target.value + '%';
            });
        });

        // define addLayer() function outside of scope
        function addLayer(geojson) {
            // add the source to the map
            map.addSource('redlining', {
                'type': 'geojson',
                'data': geojson // use my data as source
            });

            // add the GeoJSON data as a mapbox gl layer (now a raster?) to visualize polygon
            map.addLayer({
                'id': 'redlining', // provide new id for later reference 
                'type': 'fill',
                'source': 'redlining', //refers to data source name entered above
                'paint': {
                    'fill-color': [ // '#00364e', initial fill color until add identity
                        'match',
                        ['get', 'holc_grade'],
                        'A',
                        'green',
                        'B',
                        'blue',
                        'C',
                        'yellow',
                        'D',
                        'red',
                        // other not caught
                        'black'
                    ],
                    //'fill-opacity': 1, //initial opacity until slider added
                    //'fill-outline-color': 'white'
                }
            });
        };

        // map 2 script
        const map2 = new mapboxgl.Map({
            container: 'map2', //container ID
            style: 'mapbox://styles/rcramsey/cl0fo22zx000514ms9ohin6tx',// ‚úèÔ∏è style URL refine later
            center: [-84.51, 38.04], //strating position [lng, lat]
            zoom: 12 //starting zoom
        });

        const map2Legend = document.getElementById('map2Legend');

        // const slider2 = document.getElementById('slider2');
        // const sliderValue2 = document.getElementById('slider-value2');

        // use D3 method on map 2 to load GeoJSON when the map is finished loading
        map2.on('load', () => {
            // request GEOJSON data
            //d3.json('./data/KYLexington1936.geojson').then((geojson) => {
            d3.json('./data/race_cbtracts_hhi_own_val_pov_2019_gdf_json.json').then((geojson) => {
                // when loaded
                console.log(geojson);

                // call addLayer() function in scope
                addLayer2(geojson);
                mapSync();
            });

            // DEVELOPER TOOL TO DELETE PRIOR TO LAUNCH
            // slider.addEventListener('input', (e)=> {
            //     // Adjust the layers opacity.
            //     map2.setPaintProperty(
            //         // source Id
            //         'other',
            //         // when the layer is created in mapbox from my geojson, it is added as a raster? right?
            //         'fill-opacity',
            //         parseInt(e.target.value, 10) / 100
            //     );

            //     // Value Indicator
            //     sliderValue.textContent = e.target.value + '%';
            // });
        });

        // define addLayer() function outside of scope
        function addLayer2(geojson) {
            // add the source to the map
            map2.addSource('census', {
                'type': 'geojson',
                'data': geojson // use my data as source
            });

            // add the GeoJSON data as a mapbox gl layer (now a raster?) to visualize polygon
            // access census bureau race/segretation data
            map2.addLayer({
                'id': 'race', // provide new id for later reference 
                'type': 'fill',
                'source': 'census', //refers to data source name entered above
                'layout':
                {
                    'visibility': 'visible'
                },
                'paint': {
                    'fill-color': {
                        property: '%White',
                        stops: [[0, '#efedf5'], [100, '#756bb1']],
                    },
                    'fill-opacity': .45, //initial opacity until slider added
                    'fill-outline-color': 'white'
                }
            });

            // access census bureaus median income data
            map2.addLayer({
                'id': 'income', // provide new id for later reference 
                'type': 'fill',
                'source': 'census', //refers to data source name entered above
                'layout':
                {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-color': {
                        property: 'median_income_dollars',
                        stops: [[20000, '#fff'], [120000, '#f00']],
                    },
                    'fill-opacity': .45, //initial opacity until slider added
                    'fill-outline-color': 'white'
                }
            });

            // access census bureau ownership vs rental status data
            map2.addLayer({
                'id': 'ownership', // provide new id for later reference 
                'type': 'fill',
                'source': 'census', //refers to data source name entered above
                'layout':
                {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-color': {
                        property: '%owner',
                        stops: [[0, '#deebf7'], [100, '#3182bd']],
                    },
                    'fill-opacity': .45, //initial opacity until slider added
                    'fill-outline-color': 'white'
                }
            });


            addUI();


            // // Access census bureau property data
            //üßØ Need to convert string value to number valueüßØ 
            // map2.addLayer({
            //     'id': 'propertyValue', // provide new id for later reference 
            //     'type': 'fill',
            //     'source': 'census', //refers to data source name entered above
            //     'paint': {
            //         'fill-color': {
            //             property: 'median dollar house',
            //           //  ['to-number', ['get', 'median dollar house']],
            //             stops: [[100000, '#e5f5e0'], [1000000, '#31a354']],
            //         },
            //         'fill-opacity': 1, //initial opacity until slider added
            //         'fill-outline-color': 'white'
            //     }
            // });
        };

        // Use d3 to select all 'a' targets in dropdown menu
        // when clicked the value of that current target is passed to function updateCurrentLayer
        function addUI() {
            d3.selectAll('.dropdown-content a').on('click', (e) => {
                let currentValue = d3.select(e.target).attr('value');
                updateCurrentLayer(currentValue);
                whatsMap2Style(currentValue);
            });
        }

        // pass value from div class drop down content in drop down menu
        // function to set all visibility to none until.
        function updateCurrentLayer(val) {
            map2.setLayoutProperty('race', 'visibility', 'none');
            map2.setLayoutProperty('income', 'visibility', 'none');
            map2.setLayoutProperty('ownership', 'visibility', 'none');
            // change visibility to visible for whicheer val is clicked in drop down menu
            map2.setLayoutProperty(val, 'visibility', 'visible');
        }

        // Map & Map 2 syncing movement
        function mapSync() {
            // if disable true then the map will be displayed as non-interactive
            var disable = false; // interactive
            map.on('move', function () {

                if (!disable) { // boolean, if not do below
                    var center = map.getCenter();
                    var zoom = map.getZoom();

                    // convert disable to be true
                    // prevents looping between both maps so only one can be moved
                    disable = true; // map 1 non interactive (static)

                    // set map 2 to new map center & zoom
                    map2.setCenter(center);
                    map2.setZoom(zoom);
                    disable = false; // map 1 back to interactive
                }
            })

            map2.on('move', function () {
                if (!disable) { // boolean, it not true do below
                    var center = map2.getCenter();
                    var zoom = map2.getZoom();

                    // convert disable to be true
                    // prevents looping between both maps so only one can be moved
                    disable = true; // map 2 non interactive (static)

                    // set first map to new map 2 center & zoom
                    map.setCenter(center);
                    map.setZoom(zoom);
                    disable = false; // map 2 back to interactive
                }
            })
        };


        
        ///////////////////////////////////////////////////////////////////////////
        //Place Holder for get styling layers for legend
         function whatsMap2Style(val) {
             const map2Style = map2.getStyle(); //array of map2styles set to variable

            //if/else loop to determine which layer is selected
            // therefore which colors to pass on
            // need to modify if/else to return colors as map2Colors
            if (val == 'race') {
            console.log('value is race'); 
            
            //var colors = map2Style.layers[86].paint.'fill-color'.stops; //array of color styling array set to variable
            //console.log(colors);
            //return colors
            
            // üßØaccess the legend bar and background linear-gradient to change stop colors
            //access the colorGradient assigned back on line 200
            //change the element id style background to these if layer clicked
            //colorGradient = rgba (0,0,0,0) linear-gradient(to right, #efedf5, #756bb1);

            } else if (val == 'income') {
                console.log('value is income');
                 //const incomeColors = map2Style.layers[87]; //array of color styling array set to variable
                 // return colors
            } else if (val == 'ownership') {
                console.log('value is ownership');
                 //const ownershipColors = map2Style.layer[88]; //array of color sytling array set to variable
                 // return colors
            } 
            // else if (val == 'propertyValue') {
            //     console.log('value is propertyValue');
            // } 
            else {
                console.log('no value selected');
            }; 
            
            
        };

    
        // add mapbox inspection tool for development only
        // ‚úèÔ∏è  when i add this control, click and unclick I lose my layer
        // map.addControl(new MapboxInspect());  // click on box top right hand corner to 

    </script>

</body>

</html>